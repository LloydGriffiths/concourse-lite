#!/bin/bash

set -e

CONCOURSE_RELEASE_VERSION=${1}
GARDEN_LINUX_RELEASE_VERSION=${2}

function usage() {
  echo "usage: $0 CONCOURSE_RELEASE_VERSION GARDEN_LINUX_RELEASE_VERSION" >&2
  exit 1
}

[ -n "$CONCOURSE_RELEASE_VERSION" ] || usage
[ -n "$GARDEN_LINUX_RELEASE_VERSION" ] || usage

build_dir=$(cd $(dirname $0)/.. && pwd)
templates_dir=$(cd ${build_dir}/templates && pwd)

sed \
  -e "s/CONCOURSE_RELEASE_VERSION/${CONCOURSE_RELEASE_VERSION}/g" \
  -e "s/GARDEN_LINUX_RELEASE_VERSION/${GARDEN_LINUX_RELEASE_VERSION}/g" \
  ${templates_dir}/concourse_manifest.yml > \
  ${build_dir}/concourse_manifest.yml
